# å¤šé˜¶æ®µæ„å»º - ç¬¬ä¸€é˜¶æ®µï¼šä½¿ç”¨ Node.js æ„å»º
FROM node:20-alpine AS builder
WORKDIR /build

# å¤åˆ¶ package.json å’Œ package-lock.jsonï¼ˆåˆ©ç”¨ Docker ç¼“å­˜ï¼‰
COPY package*.json ./
RUN echo "ğŸ“¦ [å‰ç«¯] å¼€å§‹å®‰è£… npm ä¾èµ–..." && \
    npm ci --only=production=false && \
    echo "âœ… [å‰ç«¯] npm ä¾èµ–å®‰è£…å®Œæˆ"

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY . .
RUN echo "ğŸ”¨ [å‰ç«¯] å¼€å§‹æ„å»º Vue é¡¹ç›®..." && \
    npm run build && \
    echo "âœ… [å‰ç«¯] æ„å»ºå®Œæˆ"

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œæ—¶ç¯å¢ƒ
FROM nginx:alpine
WORKDIR /usr/share/nginx/html

# åˆ é™¤é»˜è®¤çš„ nginx å†…å®¹
RUN rm -rf ./*

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºç»“æœ
COPY --from=builder /build/dist .

# å¤åˆ¶ nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

# æš´éœ²ç«¯å£
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
